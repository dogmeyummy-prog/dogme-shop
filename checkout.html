<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dogme Cart | æˆ‘çš„è´§æŸœæ¸…å• ğŸ¾</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Quicksand', sans-serif; }
        .cart-item { background: white; border-radius: 20px; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); border: 1px solid rgba(255,141,54,0.05); }
        @media (min-width: 768px) { .cart-item { border-radius: 30px; } }
        .cart-item:hover { transform: scale(1.02); box-shadow: 0 15px 30px rgba(0,0,0,0.05); }
        .checkout-bar { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border-top: 1px solid rgba(0,0,0,0.05); }
        .active-press:active { transform: scale(0.96); }
    </style>
</head>
<body class="bg-[#fdfcf9] min-h-screen pb-40">

    <!-- æ·»åŠ è¯­è¨€åˆ‡æ¢å’Œå“åº”å¼é€‚é… -->
    <nav class="flex justify-between items-center px-4 md:px-6 lg:px-12 py-4 md:py-6 sticky top-0 z-50 bg-white/60 backdrop-blur-xl border-b border-orange-50">
        <div class="flex items-center gap-2 md:gap-4">
            <button onclick="location.href='shopping.html'" class="w-10 h-10 md:w-11 md:h-11 rounded-2xl bg-white shadow-sm flex items-center justify-center text-orange-500 active-press border border-orange-50">â®</button>
            <h1 class="text-lg md:text-2xl font-black text-gray-800 tracking-tighter" data-t="checkout_title">æˆ‘çš„è´§æŸœæ¸…å•</h1>
        </div>
        <div class="flex items-center gap-2 md:gap-3">
            <div class="flex bg-gray-100 rounded-xl overflow-hidden">
                <button onclick="switchLanguage('zh')" id="lang-zh" class="px-2 py-1.5 text-[8px] md:text-[9px] font-black uppercase tracking-wider transition-colors">ä¸­æ–‡</button>
                <button onclick="switchLanguage('en')" id="lang-en" class="px-2 py-1.5 text-[8px] md:text-[9px] font-black uppercase tracking-wider transition-colors">EN</button>
                <button onclick="switchLanguage('fr')" id="lang-fr" class="px-2 py-1.5 text-[8px] md:text-[9px] font-black uppercase tracking-wider transition-colors">FR</button>
            </div>
            <div id="checkout-rank-status" class="flex items-center gap-2 md:gap-3 bg-white px-3 md:px-4 py-1.5 md:py-2 rounded-2xl shadow-sm border border-gray-100">
                <span id="rank-emoji">ğŸ¾</span>
                <span id="rank-name-display" class="font-black text-[10px] md:text-xs text-gray-600" data-t="checkout_loading">åŠ è½½ä¸­...</span>
            </div>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto px-4 md:px-6 mt-6 md:mt-10">
        <div id="discount-banner" class="mb-6 md:mb-8 p-4 md:p-5 rounded-[25px] md:rounded-[30px] bg-gray-900 text-white flex items-center justify-between hidden">
            <div class="flex items-center gap-3 md:gap-4">
                <div class="text-2xl md:text-3xl">ğŸ’</div>
                <div><p id="discount-desc" class="font-black text-xs md:text-sm" data-t="checkout_discount_activated">ç­‰çº§ç‰¹æƒå·²æ¿€æ´»</p></div>
            </div>
            <div id="discount-tag" class="px-3 md:px-4 py-1.5 md:py-2 bg-white/20 rounded-full font-black text-xs md:text-sm italic">-0%</div>
        </div>

        <div id="empty-cart" class="hidden text-center py-12 md:py-20">
            <div class="text-6xl md:text-8xl mb-4 md:mb-6">ğŸ›’</div>
            <h2 class="text-xl md:text-2xl font-black text-gray-400" data-t="checkout_empty_title">è´§æŸœç©ºç©ºå¦‚ä¹Ÿ</h2>
        </div>

        <div id="cart-list" class="space-y-3 md:space-y-4"></div>
    </main>

    <footer class="fixed bottom-0 left-0 right-0 checkout-bar p-4 md:p-6 lg:px-20 z-50">
        <div class="max-w-3xl mx-auto flex items-center justify-between">
            <div>
                <span id="original-price" class="text-gray-400 text-xs md:text-sm line-through font-bold hidden">$0.00</span>
                <p id="total-price" class="text-2xl md:text-4xl font-black text-gray-800">$0.00</p>
            </div>
            <button id="pay-btn" onclick="goToPay()" class="px-6 md:px-12 py-3 md:py-5 bg-gray-900 text-white rounded-[20px] md:rounded-[28px] font-black text-base md:text-xl active-press shadow-2xl hover:bg-orange-600 transition-all" data-t="checkout_pay_btn">
                å‰å¾€æ”¯ä»˜ ğŸ¾
            </button>
        </div>
    </footer>

    <!-- å¼•å…¥ i18n.js -->
    <script src="i18n.js"></script>
    
    <script>
        let cart = JSON.parse(localStorage.getItem('dogme_cart')) || [];

        function updateLanguageButtons() {
            const lang = localStorage.getItem('dogme_lang') || 'zh';
            ['zh', 'en', 'fr'].forEach(l => {
                const btn = document.getElementById(`lang-${l}`);
                if (l === lang) {
                    btn.classList.add('bg-gray-900', 'text-white');
                    btn.classList.remove('text-gray-400');
                } else {
                    btn.classList.remove('bg-gray-900', 'text-white');
                    btn.classList.add('text-gray-400');
                }
            });
        }

        function getRankBenefit() {
            const exp = parseInt(localStorage.getItem('dogme_user_exp') || '0');
            const rank = Math.min(Math.floor(exp / 10) + 1, 10);
            let discount = 1;
            let name = 'Level V' + rank;
            
            if (rank >= 10) discount = 0.8;
            else if (rank >= 9) discount = 0.85;
            else if (rank >= 6) discount = 0.9;
            else if (rank >= 3) discount = 0.95;
            
            return { discount, info: { name, rank } };
        }

        function renderCart() {
            const container = document.getElementById('cart-list');
            const benefit = getRankBenefit();
            document.getElementById('rank-name-display').innerText = benefit.info.name;
            document.getElementById('rank-emoji').innerText = benefit.info.rank >= 10 ? 'ğŸ‘‘' : 'ğŸ¾';

            if (cart.length === 0) {
                document.getElementById('empty-cart').classList.remove('hidden');
                document.getElementById('cart-list').innerHTML = '';
                document.getElementById('total-price').innerText = "$0.00";
                return;
            }

            let subtotal = 0;
            container.innerHTML = cart.map((item, index) => {
                subtotal += item.price;
                return `<div class="cart-item p-4 md:p-6 flex items-center justify-between">
                    <div class="flex items-center gap-4 md:gap-6"><div class="text-3xl md:text-5xl">${item.emoji}</div>
                    <div><h3 class="font-black text-sm md:text-base text-gray-800">${item.name}</h3><p class="text-xs md:text-sm text-gray-400 font-bold">$${item.price.toFixed(2)}</p></div></div>
                    <button onclick="removeItem(${index})" class="text-gray-300 font-bold text-lg md:text-xl">âœ•</button>
                </div>`;
            }).join('');
            
            const finalPrice = subtotal * benefit.discount;
            document.getElementById('total-price').innerText = `$${finalPrice.toFixed(2)}`;

            const originalPriceEl = document.getElementById('original-price');
            const discountBanner = document.getElementById('discount-banner');
            const discountDesc = document.getElementById('discount-desc');
            
            if(benefit.discount < 1) {
                originalPriceEl.innerText = `$${subtotal.toFixed(2)}`;
                originalPriceEl.classList.remove('hidden');
                discountBanner.classList.remove('hidden');
                document.getElementById('discount-tag').innerText = `-${Math.round((1-benefit.discount)*100)}%`;
                
                const lang = localStorage.getItem('dogme_lang') || 'zh';
                const t = window.translations?.[lang] || window.translations?.['zh'];
                if (t) {
                    discountDesc.innerText = `${t.checkout_as} ${benefit.info.name}${t.checkout_enjoy_discount}`;
                }
            } else {
                originalPriceEl.classList.add('hidden');
                discountBanner.classList.add('hidden');
            }
        }

        function goToPay() {
            if (cart.length === 0) return;
            localStorage.setItem('dogme_pending_total', document.getElementById('total-price').innerText);
            location.href = 'pay.html';
        }

        function removeItem(index) {
            cart.splice(index, 1);
            localStorage.setItem('dogme_cart', JSON.stringify(cart));
            renderCart();
        }

        window.translations = translations;

        window.onload = () => {
            renderCart();
            updateLanguageButtons();
        };
    </script>
</body>
</html>
