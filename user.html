<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dogme | è´¦æˆ·ä¸­å¿ƒ ğŸ¾</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Quicksand', sans-serif; background: #fdfcf9; }
        .active-press:active { transform: scale(0.95); }
        @keyframes floatIn { 0% { transform: translate(-50%, 20px); opacity: 0; } 100% { transform: translate(-50%, 0); opacity: 1; } }
        .toast-msg {
            position: fixed; bottom: 10%; left: 50%; transform: translateX(-50%);
            background: #2D3436; color: white; padding: 14px 28px; border-radius: 20px;
            font-size: 13px; font-weight: 700; z-index: 10000; animation: floatIn 0.3s ease forwards;
        }
        /* ğŸŒŸ ç²¾å‡†å±…ä¸­æ ¡æ­£ */
        .back-arrow-container {
            width: 44px; height: 44px; border-radius: 50%; background: white;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); cursor: pointer;
        }
        .back-icon-fix { transform: translateX(-1px); } /* è¡¥å¿ SVG è§†è§‰é‡å¿ƒ */
        
        .login-card { background: white; border-radius: 40px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.02); }
        .avatar-box { width: 90px; height: 90px; border-radius: 30px; border: 4px solid #f7f7f7; margin: 0 auto 24px; overflow: hidden; }
    </style>
</head>
<body class="p-6">
    <nav class="max-w-xl mx-auto flex mb-12">
        <div onclick="location.href='index.html'" class="back-arrow-container active-press">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="back-icon-fix">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
        </div>
    </nav>

    <main class="max-w-md mx-auto">
        <div class="login-card text-center">
            <div class="avatar-box">
                <img src="user.jpg" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/90'">
            </div>
            <h2 class="text-2xl font-black mb-8">éªŒè¯èº«ä»½</h2>
            
            <div class="space-y-4">
                <input type="email" id="email" placeholder="è¾“å…¥é‚®ç®±" class="w-full py-4 px-6 bg-gray-50 rounded-2xl font-bold outline-none border-2 border-transparent focus:border-orange-500 transition-all">
                <div class="flex gap-2">
                    <input type="text" id="code" placeholder="éªŒè¯ç " class="flex-1 py-4 px-6 bg-gray-50 rounded-2xl font-bold text-center">
                    <button id="send-btn" onclick="sendCode()" class="px-6 bg-gray-900 text-white rounded-2xl font-black text-xs active-press">è·å–</button>
                </div>
                <button onclick="login()" class="w-full py-5 bg-orange-500 text-white rounded-[25px] font-black shadow-lg shadow-orange-100 mt-4 active-press">å¼€å¯ä¹‹æ—…</button>
            </div>
        </div>
    </main>

    <script>
        const API = "/api/server"; // ğŸŒŸ å…³é”®ï¼šç›´æ¥æŒ‡å‘åç«¯å…¥å£

        function showToast(m) {
            const t = document.createElement('div'); t.className = 'toast-msg'; t.innerText = m;
            document.body.appendChild(t); setTimeout(() => t.remove(), 2500);
        }

        async function sendCode() {
            const email = document.getElementById('email').value;
            const btn = document.getElementById('send-btn');
            btn.disabled = true;

            try {
                const res = await fetch(API, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ action: 'send-code', email })
                });
                const data = await res.json();
                if(data.success) { showToast("å‘é€æˆåŠŸ âœ¨"); } 
                else { showToast(data.msg); btn.disabled = false; }
            } catch(e) { showToast("äº‘ç«¯æœªå“åº” âš ï¸"); btn.disabled = false; }
        }

        async function login() {
            const email = document.getElementById('email').value;
            const code = document.getElementById('code').value;
            try {
                const res = await fetch(API, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ action: 'verify-code', email, code })
                });
                const data = await res.json();
                if(data.success) {
                    localStorage.setItem('dogme_user_logged', 'true');
                    localStorage.setItem('dogme_user_email', email);
                    location.href = 'Log-in.html';
                } else { showToast("éªŒè¯ç é”™è¯¯ âŒ"); }
            } catch(e) { showToast("ç™»å½•å¼‚å¸¸"); }
        }
    </script>
</body>
</html>
